"use strict";(self.webpackChunkjob=self.webpackChunkjob||[]).push([[2054],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p="mdxType",h={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=c(n),d=r,m=p["".concat(l,".").concat(d)]||p[d]||h[d]||o;return n?a.createElement(m,s(s({ref:t},u),{},{components:n})):a.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=d;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[p]="string"==typeof e?e:r,s[1]=i;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9439:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>p,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={},s="When to use Microtasks?",i={unversionedId:"questions/frontend/browser-microtasks",id:"questions/frontend/browser-microtasks",title:"When to use Microtasks?",description:"It's important to note again that most developers won't use microtasks much, if at all. They're a highly specialized feature of modern browser-based JavaScript development, allowing you to schedule code to jump in front of other things in the long set of things waiting to happen on the user's computer. Abusing this capability will lead to performance problems.",source:"@site/interview/questions/frontend/browser-microtasks.md",sourceDirName:"questions/frontend",slug:"/questions/frontend/browser-microtasks",permalink:"/questions/frontend/browser-microtasks",draft:!1,editUrl:"https://github.com/izemil/job/edit/master/interview/questions/frontend/browser-microtasks.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"What is an Event Loop?",permalink:"/questions/frontend/browser-event-loop"},next:{title:"What are the different types of CSS units, and how do they work?",permalink:"/questions/frontend/css-units"}},l={},c=[],u={toc:c};function p(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"when-to-use-microtasks"},"When to use Microtasks?"),(0,r.kt)("p",null,"It's important to note again that most developers won't use microtasks much, if at all. They're a highly specialized feature of modern browser-based JavaScript development, allowing you to schedule code to jump in front of other things in the long set of things waiting to happen on the user's computer. ",(0,r.kt)("em",{parentName:"p"},"Abusing this capability will lead to performance problems.")),(0,r.kt)("p",null,"The main reason to use microtasks is that: to ensure consistent ordering of tasks, even when results or data is available synchronously, but while simultaneously reducing the risk of user-discernible delays in operations."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"One situation in which microtasks can be used to ensure that the ordering of execution is always consistent is when promises are used in one clause of an\xa0",(0,r.kt)("inlineCode",{parentName:"li"},"if...else"),"\xa0statement (or other conditional statement), but not in the other clause. Consider code such as this:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"customElement.prototype.getData = (url) => {\n    if (this.cache[url]) {\n        this.data = this.cache[url];\n        this.dispatchEvent(new Event('load'));\n    } else {\n        fetch(url)\n            .then((result) => result.arrayBuffer())\n            .then((data) => {\n                this.cache[url] = data;\n                this.data = data;\n                this.dispatchEvent(new Event('load'));\n            });\n    }\n};\n")),(0,r.kt)("p",null,"The problem introduced here is that by using a task in one branch of the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"if...else"),"\xa0statement (in the case in which the image is available in the cache) but having promises involved in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"else"),"\xa0clause, we have a situation in which the order of operations can vary; for example, as seen below."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"element.addEventListener('load', () => console.log('Loaded data'));\nconsole.log('Fetching data\u2026');\nelement.getData();\nconsole.log('Data fetched');\n")),(0,r.kt)("p",null,"Executing this code twice in a row gives the following results."),(0,r.kt)("p",null,"When the data is not cached:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Fetching data\nData fetched\nLoaded data\n")),(0,r.kt)("p",null,"When the data is cached:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Fetching data\nLoaded data\nData fetched\n")),(0,r.kt)("p",null,"Even worse, sometimes the element's\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"data"),"\xa0property will be set and other times it won't be by the time this code finishes running."),(0,r.kt)("p",null,"We can ensure consistent ordering of these operations by using a microtask in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"if"),"\xa0clause to balance the two clauses:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"customElement.prototype.getData = (url) => {\n    if (this.cache[url]) {\n        queueMicrotask(() => {\n            this.data = this.cache[url];\n            this.dispatchEvent(new Event('load'));\n        });\n    } else {\n        fetch(url)\n            .then((result) => result.arrayBuffer())\n            .then((data) => {\n                this.cache[url] = data;\n                this.data = data;\n                this.dispatchEvent(new Event('load'));\n            });\n    }\n};\n")),(0,r.kt)("p",null,"This balances the clauses by having both situations handle the setting of\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"data"),"\xa0and firing of the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"load"),"\xa0event within a microtask (using\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"queueMicrotask()"),"\xa0in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"if"),"\xa0clause and using the promises used by\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"fetch()"),"\xa0in the\xa0",(0,r.kt)("inlineCode",{parentName:"p"},"else"),"\xa0clause)."),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"You can also use microtasks to collect multiple requests from various sources into a single batch, avoiding the possible overhead involved with multiple calls to handle the same kind of work.")),(0,r.kt)("p",null,"The snippet below creates a function that batches multiple messages into an array, using a microtask to send them as a single object when the context exits."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const messageQueue = [];\n\nlet sendMessage = (message) => {\n    messageQueue.push(message);\n\n    if (messageQueue.length === 1) {\n        queueMicrotask(() => {\n            const json = JSON.stringify(messageQueue);\n            messageQueue.length = 0;\n            fetch('url-of-receiver', json);\n        });\n    }\n};\n")))}p.isMDXComponent=!0}}]);